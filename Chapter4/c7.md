## 内存管理方案补充

### TaggedPointer

* 在64bit开始，iOS引入了Tagged Pointer技术，用于优化NSNumber、NSDate、NSString等小对象存储
* 在没有使用Tagged Pointer之前，NSNumer等对象需要动态分配内存、维护引用技术等，NSNumber指针存储的是堆中NSNumber对象的地址值
* 使用Tagged Pointer之后，NSNumber指针里面存储的数据变成了：Tag + Data，也就是将数据存储在了指针中
* 当指针不够存储数据时，才会使用动态分配内存的方式来存储数据
* objc_msgSend能识别Tagged Pointer，比如NSNumber的intValue方法，直接从指针提取数据，节省了以前的调用开销
* 如何判断一个指针是否为Tagged Pointer？
  * iOS平台，最高有效位是1（第64bit）
  * Mac平台，最低有效位是1

一个类对象指针需要8个字节的内存空间，因为所有的对象是集成在NSObject。NSObject类对象需要8个指针，NSObject实例对象需要16个字节存储空间，因为iOS需要占用8个字节，再加上`内存对齐`为16个字节.

Tagged Pointer指针的值不再是地址了，而是真正的值。所以，实际上它不再是一个对象了，它只是一个披着对象皮的普通变量而已！所以，它的内存并不存储在堆中，也不需要malloc和free。
在内存读取上有着3倍的效率（以前是寻址->发消息->获取值，现在直接获取值），创建时比以前快106倍。

可在本章节[NSObject占用多少内存](/Chapter18/c1.md)查看`内存对齐`相关知识

### NONPOINTER_ISA